@model IEnumerable<ListAdvertsModel>

@{
    ViewBag.Title = "Tüm İlanlar";
}
<body>
    <h4 class="mt-5 mb-5">@ViewBag.CityName İlindeki Tüm İlanlar</h4>
    <div class="container text-center">
        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success">
                @TempData["SuccessMessage"]
            </div>
        }

        @if (TempData["ErrorMessage"] != null)
        {
            <div class="alert alert-danger">
                @TempData["ErrorMessage"]
            </div>
        }
         @if (Model != null && Model.Any())
        {
            foreach (var advert in Model)
            {
                if (advert.Status == RealEstate.Entity.Status.Passive)
                {
                    continue;
                }
                var cardClass = advert.PaidAdvertChoice == "Çerçeve İçinde Göster" ? "card border" : "card";
                var cardStyle = advert.PaidAdvertChoice == "Çerçeve İçinde Göster" ? "4px solid green !important;" : "";
                <div class="@cardClass d-flex flex-row mb-3" style="max-height: 15rem; border: @cardStyle">
                    <img src="@Url.Content($"~/images/{ViewBag.CityName}.png")" class="card-img-start" alt="..." style="width: 14rem;">
                    <div class="card-body text-start">
                       
                        <div class="row">
                            <div class="col-6">
                                <h5 class="card-title">@advert.Title</h5>
                                <p class="card-text">@advert.Description</p>
                                <div>
                                    <i class="bi bi-geo-alt"></i> @advert.DistrictName
                                </div>

                                <a href="@Url.Action("GetAdvert", "AdvertDetails", new { advertID = advert.AdvertID })" class="btn btn-outline-dark btn mt-4">İncele</a>
                            </div>
                            <div class="col-6">
                                <div class="text-end mt-0">
                                    
                                    @if (advert.IsFavourite)
                                    {
                                        <a class="btn text-center" href="" role="button" style="color:red;">
                                            <i class="bi bi-heart-fill me-1"></i>
                                        </a>
                                    }
                                    
                                    else
                                    {
                                        <!--<a class="btn text-center" href="@Url.Action("AddToFavourites", "AddToFavourites", new { advertID = advert.AdvertID, cityName = advert.CityName})" role="button">
                                            <i class="bi bi-heart me-1"></i>
                                        </a> -->
                                        

                                        <form id="favouriteForm" method="post" action="@Url.Action("AddToFavourites", "AddToFavourites", new { advertID = advert.AdvertID, cityName = advert.CityName })">
                                            <button type="submit" class="btn text-center" role="button">
                                                <i class="bi bi-heart me-1"></i>
                                            </button>
                                        </form>
                                    }
                                </div>
                                <p class="card-text text-center mt-4 fs-5">@advert.Price TL</p>
                                
                            </div>
                        </div>   
                    </div>
                </div>
            }
        }
        else
        {
            <p class="alert text-danger text-start fw-bold fs-5">Seçilen ilde ilan bulunamadı</p>
            
        }

    </div>
    @section Scripts {
        <script>
            // Sayfanın kaydırma konumunu yerel depolamada sakla
            function saveScrollPosition() {
                localStorage.setItem('scrollPosition', window.scrollY);
            }

            // Saklanan kaydırma konumunu geri yükle
            function loadScrollPosition() {
                const scrollPosition = localStorage.getItem('scrollPosition');
                if (scrollPosition) {
                    window.scrollTo(0, parseInt(scrollPosition, 10));
                    localStorage.removeItem('scrollPosition');
                }
            }

            document.addEventListener('DOMContentLoaded', function () {
                // Form gönderildiğinde kaydırma konumunu sakla
                document.getElementById('favouriteForm').addEventListener('submit', saveScrollPosition);

                // Sayfa yüklendiğinde kaydırma konumunu geri yükle
                loadScrollPosition();
            });
        </script>
    }

</body>